/**
 * Jeeliz Weboji - https://github.com/jeeliz/jeelizWeboji
 *
 * Copyright 2018 Jeeliz ( https://jeeliz.com )
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/

window.JEELIZ_FILTER = (function(){function ja(a){a(c.Sa);/*var b=new XMLHttpRequest;b.open("GET",c.Sa+c.save,!0);b.withCredentials=!1;b.onreadystatechange=function(){4===b.readyState&&200===b.status&&a(b.responseText)};b.send()*/}function na(){var a=c.wb,b=Array(a),d;for(d=0;d<a;++d)b[d]=0;return b}function oa(a,b,d){a=Math.min(Math.max((d-a)/(b-a),0),1);return a*a*(3-2*a)}function qa(a,b,d){return Math.min(Math.max((d-a)/(b-a),0),1)}function ra(a,b,d,e){return Math.pow(Math.min(Math.max((e-a)/(b-a),0),1),d)}
function sa(a){switch(a){case "relu":return"gl_FragColor=max(vec4(0.,0.,0.,0.),gl_FragColor);";case "elu":return"gl_FragColor=mix(exp(-abs(gl_FragColor))-vec4(1.,1.,1.,1.),gl_FragColor,step(0.,gl_FragColor));";case "elu01":return"gl_FragColor=mix(0.1*exp(-abs(gl_FragColor))-vec4(0.1,0.1,0.1,0.1),gl_FragColor,step(0.,gl_FragColor));";case "arctan":return"gl_FragColor=atan(3.14159265359*texture2D(u0,vUV))/3.14159265359;";case "copy":return"";default:return!1}}
function ua(a,b){var d=b%8;return a[(b-d)/8]>>7-d&1}
function xa(a){var b=JSON.parse(a);a=b.ne;var d=b.nf,e=b.n,g="undefined"===typeof btoa?Buffer.from(b.data,"base64").toString("latin1"):atob(b.data),f=g.length,k;b=new Uint8Array(f);for(k=0;k<f;++k)b[k]=g.charCodeAt(k);g=new Float32Array(e);f=new Float32Array(d);k=a+d+1;var m,r;for(m=0;m<e;++m){var h=k*m;var t=0===ua(b,h)?1:-1;var q=h+1;var n=1,u=0;for(r=q+a-1;r>=q;--r)u+=n*ua(b,r),n*=2;r=u;q=b;n=h+1+a;u=f;var A=0,B=u.length;for(h=n;h<n+B;++h)u[A]=ua(q,h),++A;for(h=q=0;h<d;++h)q+=f[h]*Math.pow(2,-h-
1);t=0===q&&0===r?0:t*(1+q)*Math.pow(2,1+r-Math.pow(2,a-1));g[m]=t}return g}
var p=function(){function a(a,b){a=l.createShader(a);l.shaderSource(a,b);l.compileShader(a);return l.getShaderParameter(a,l.COMPILE_STATUS)?a:!1}function b(b,d){b=a(l.VERTEX_SHADER,b);d=a(l.FRAGMENT_SHADER,d);var e=l.createProgram();l.attachShader(e,b);l.attachShader(e,d);l.linkProgram(e);return e}function d(a){void 0===a.aa&&(a.aa="precision lowp float;attribute vec2 a0;varying vec2 vv0;void main(){gl_Position=vec4(a0,0.,1.),vv0=a0*.5+vec2(.5,.5);}");void 0===a.da&&(a.da=["a0"]);void 0===a.V&&(a.V=
[2]);if(void 0===a.precision||"highp"===a.precision)a.precision=r;a.id=k++;void 0!==a.Tc&&a.Tc.forEach(function(b,d){a.c=a.c.replace(b,a.qa[d])});a.Ra=0;a.V.forEach(function(b){a.Ra+=4*b});a.pa=b(a.aa,"precision "+a.precision+" float;\n"+a.c);a.l={};a.f.forEach(function(b){a.l[b]=l.getUniformLocation(a.pa,b)});a.attributes={};a.W=[];a.da.forEach(function(b){var d=l.getAttribLocation(a.pa,b);a.attributes[b]=d;a.W.push(d)});if(a.h){l.useProgram(a.pa);f=a;g=a.id;for(var d in a.h)l.uniform1i(a.l[d],a.h[d])}a.Jd=
!0}function e(a){ya.Zc(C);g!==a.id&&(C.M(),g=a.id,f=a,l.useProgram(a.pa),a.W.forEach(function(a){0!==a&&l.enableVertexAttribArray(a)}))}var g=-1,f=!1,k=0,m=!1,r="highp",h=["u1"],t=["u0"],q={u1:0},n={u0:0},u={u1:0,u2:1},A={u3:0},B={s0:{c:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",f:h,h:q},s1:{c:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",f:h,h:q,precision:"lowp"},s2:{c:"uniform sampler2D u1,u2;varying vec2 vv0;void main(){vec4 a=texture2D(u2,vv0),b=texture2D(u1,vv0);gl_FragColor=a*b;}",
f:["u1","u2"],h:u},s3:{c:"uniform sampler2D u1;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=a.r*f;}",f:h,h:q},s4:{c:"uniform sampler2D u1,u2;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u2,vv0),b=texture2D(u1,vv0);gl_FragColor=a.a*b.r*f;}",f:["u1","mask"],h:u},s5:{c:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vec2(1.-vv0.x,vv0.y));}",f:h,h:q},s6:{c:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vec2(vv0.x,1.-vv0.y));}",
f:h,h:q},s7:{c:"uniform sampler2D u0;uniform float u4;varying vec2 vv0;void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=a*u4;}",f:["u0","u4"],h:n},s8:{c:"uniform sampler2D u0;uniform float u4;varying vec2 vv0;const vec4 g=vec4(.25,.25,.25,.25),e=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0);float b=dot(a*u4,g);gl_FragColor=b*e;}",f:["u0","u4"],h:n},s9:{c:"uniform sampler2D u1;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.);void main(){float a=.25*dot(e,texture2D(u1,vv0));gl_FragColor=a*e;}",
f:h,h:q},s10:{c:"uniform sampler2D u1,u5;uniform float u6;const vec4 f=vec4(1.,1.,1.,1.);varying vec2 vv0;void main(){vec4 a=texture2D(u1,vv0),b=texture2D(u5,vv0);gl_FragColor=mix(b,a,u6*f);}",f:["u1","u5","u6"],h:{u1:0,u5:1}},s11:{c:"uniform sampler2D u1;uniform vec2 u7;varying vec2 vv0;void main(){gl_FragColor=.25*(texture2D(u1,vv0+u7)+texture2D(u1,vv0+u7*vec2(1.,-1.))+texture2D(u1,vv0+u7*vec2(-1.,-1.))+texture2D(u1,vv0+u7*vec2(-1.,1.)));}",f:["u1","u7"],h:q},s12:{c:"uniform sampler2D u1;uniform vec4 u8;varying vec2 vv0;float g(float a,float b){a=floor(a)+.5;return floor(a/exp2(b));}float h(float a,float b){return floor(a*exp2(b)+.5);}float i(float a,float b){return mod(a,h(1.,b));}float e(float c,float a,float b){a=floor(a+.5),b=floor(b+.5);return i(g(c,a),b-a);}vec4 k(float a){if(a==0.)return vec4(0.,0.,0.,0.);float l=128.*step(a,0.);a=abs(a);float c=floor(log2(a)),m=c+127.,b=(a/exp2(c)-1.)*8388608.,d=m/2.,n=fract(d)*2.,o=floor(d),p=e(b,0.,8.),q=e(b,8.,16.),r=n*128.+e(b,16.,23.),j=l+o;return vec4(p,q,r,j)/255.;}void main(){float a=dot(texture2D(u1,vv0),u8);gl_FragColor=k(a);}",
f:["u1","u8"],h:q},s13:{c:"uniform sampler2D u0;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0),b=e/(e+exp(-a));gl_FragColor=b;}",f:t,h:n},s14:{c:"uniform sampler2D u0;varying vec2 vv0;const vec4 e=vec4(0.,0.,0.,0.);void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=max(e,a);}",f:t,h:n},s15:{c:"uniform sampler2D u0;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=mix(exp(-abs(a))-e,a,step(0.,a));}",f:t,h:n},s16:{c:"uniform sampler2D u0;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0),b=exp(-abs(a))-e;gl_FragColor=mix(.1*b,a,step(0.,a));}",
f:t,h:n},s17:{c:"uniform sampler2D u0,u6,u9;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0),c=texture2D(u6,vv0),d=texture2D(u9,vv0),b=a/d;gl_FragColor=c*mix(exp(-abs(b))-f,b,step(0.,a));}",f:["u0","u6","u9"],h:{u0:0,u6:1,u9:2}},s18:{c:"uniform sampler2D u0;const float e=3.141593;varying vec2 vv0;void main(){gl_FragColor=atan(e*texture2D(u0,vv0))/e;}",f:t,h:n},s19:{c:"uniform sampler2D u0;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.),g=vec4(.5,.5,.5,.5);void main(){vec4 a=texture2D(u0,vv0),b=log(e+a);gl_FragColor=b;}",
f:t,h:n},s20:{c:"uniform sampler2D u0;uniform float gain;varying vec2 vv0;void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=exp(a);}",f:["u0","u10"],h:n},s21:{c:"uniform sampler2D u0,u11;uniform float u12;const vec2 f=vec2(.5,.5);const float g=1e-5;const vec4 h=vec4(1.,1.,1.,1.),i=vec4(0.,0.,0.,0.);varying vec2 vv0;void main(){vec4 a=texture2D(u11,f);float b=u12*u12;vec4 c=max(b*a,g*h);gl_FragColor=texture2D(u0,vv0)/c;}",f:["u0","u13","u12"],h:{u0:0,u13:1}},s22:{c:"uniform sampler2D u1;uniform vec2 u14;varying vec2 vv0;void main(){float a=u14.x*u14.y;vec2 b=floor(vv0*a)/a,c=fract(vv0*a),d=floor(b*u14.y),g=floor(u14.x*fract(b*u14.y)),f=(g*u14.y+d)/a;gl_FragColor=texture2D(u1,f+c/a);}",
f:["u1","u14"],h:q},s23:{c:"uniform sampler2D u15,u16,u17;varying vec2 vv0;void main(){vec4 a=texture2D(u17,vv0);vec2 b=a.rg,c=a.ba;vec4 d=texture2D(u15,b),e=texture2D(u16,c);gl_FragColor=d*e;}",f:["u15","u16","u17"],h:{u16:0,u15:1,u17:2}},s24:{c:"uniform float u18;uniform sampler2D u15,u16;varying vec2 vv0;void main(){vec2 a=fract(vv0*u18);vec4 b=texture2D(u15,vv0),c=texture2D(u16,a);gl_FragColor=b*c;}",f:["u16","u15","u18"],h:{u16:0,u15:1}},s25:{c:"uniform float u18;uniform sampler2D u15,u16,u19,u20,u21,u22;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.),g=vec4(1e-3,1e-3,1e-3,1e-3);void main(){vec2 i=vv0*u18,m=floor(i),c=i-m;vec4 n=texture2D(u15,vv0),d=texture2D(u16,c),a=texture2D(u22,vv0);a=a*255.;vec4 o=texture2D(u19,c),p=texture2D(u20,c),q=texture2D(u21,c),j=step(-g,-a),b=e-j,k=b*step(-e-g,-a);b*=e-k;vec4 h=b*step(-2.*e-g,-a);b*=e-h;vec4 l=b;d=j*d+k*o+h*p+l*q,gl_FragColor=n*d;}",
f:"u15 u16 u18 u22 u19 u20 u21".split(" "),h:{u16:0,u15:1,u22:3,u19:4,u20:5,u21:6}},s26:{c:"uniform sampler2D u15,u16,u23;uniform float u18,u24,u25,u26;varying vec2 vv0;const vec2 j=vec2(1.,1.);void main(){vec2 a=floor(u24*vv0),g=u24*vv0-a;float b=u18/u24;vec2 c=floor(g*b),d=g*b-c,h=(a+d)/u24;float l=u24*u26/u18;vec2 m=l*c,i=(m+d*u25)/u26,e=step(i,j);vec4 n=texture2D(u15,h),o=texture2D(u16,i),p=n*o*e.x*e.y,k=texture2D(u23,h);gl_FragColor=p*u25*u25+k;}",f:"u15 u16 u18 u24 u25 u26 u23".split(" "),h:{u16:0,
u15:1,u23:2}},s27:{c:"uniform sampler2D u15,u16;varying vec2 vv0;void main(){vec4 a=texture2D(u15,vv0),b=texture2D(u16,vv0);gl_FragColor=a*b;}",f:["u15","u16"],h:{u16:0,u15:1}},s28:{c:"uniform sampler2D u1,u23;uniform float u27;varying vec2 vv0;void main(){gl_FragColor=texture2D(u23,vv0)+u27*texture2D(u1,vv0);}",f:["u1","u23","u27"],h:{u1:0,u23:1}},s29:{c:"varying vec2 vv0;uniform sampler2D u1;const vec4 g=vec4(1.,1.,1.,1.),e=vec4(.299,.587,.114,0.);void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=dot(a,e)*g;}",
f:h,h:q,precision:"lowp"},s30:{c:"varying vec2 vv0;uniform sampler2D u1,u2;uniform float u28;const vec4 g=vec4(1.,1.,1.,1.);void main(){vec4 a=vec4(0.);a-=texture2D(u1,vec2(vv0.x-u28,vv0.y-u28))*1.,a-=texture2D(u1,vec2(vv0.x-u28,vv0.y))*2.,a-=texture2D(u1,vec2(vv0.x-u28,vv0.y+u28))*1.,a+=texture2D(u1,vec2(vv0.x+u28,vv0.y-u28))*1.,a+=texture2D(u1,vec2(vv0.x+u28,vv0.y))*2.,a+=texture2D(u1,vec2(vv0.x+u28,vv0.y+u28))*1.;vec4 b=vec4(0.);b-=texture2D(u1,vec2(vv0.x-u28,vv0.y-u28))*1.,b-=texture2D(u1,vec2(vv0.x,vv0.y-u28))*2.,b-=texture2D(u1,vec2(vv0.x+u28,vv0.y-u28))*1.,b+=texture2D(u1,vec2(vv0.x-u28,vv0.y+u28))*1.,b+=texture2D(u1,vec2(vv0.x,vv0.y+u28))*2.,b+=texture2D(u1,vec2(vv0.x+u28,vv0.y+u28))*1.;vec3 c=sqrt(a.rgb*a.rgb+b.rgb*b.rgb);vec4 e=vec4(c,texture2D(u1,vv0).a),f=texture2D(u2,vv0);gl_FragColor=f.a*e.r*g;}",
f:["u1","u2","u28"],h:u},s31:{c:"varying vec2 vv0;uniform sampler2D u1,u2;uniform float u28;const vec4 j=vec4(1.,1.,1.,1.);const vec2 k=vec2(1.,1.);void main(){float i=0.;vec2 l=k*u28,b,c;float d,a,g=0.;for(float f=-4.;f<=4.;f+=1.)for(float e=-4.;e<=4.;e+=1.)b=vec2(f,e),d=length(b)/2.,a=exp(-d*d),c=vv0+l*b,a=1.,i+=a*texture2D(u1,c).r,g+=a;vec4 m=texture2D(u2,vv0);gl_FragColor=m.a*(texture2D(u1,c).r-i/g)*j;}",f:["u1","u2","u28"],h:u},s32:{c:"uniform sampler2D u3;uniform vec2 u7;varying vec2 vv0;vec4 e(vec4 a,vec4 b){vec4 c=step(a,b);return mix(a,b,c);}const vec2 h=vec2(.5,.5),i=vec2(1.,0.),j=vec2(0.,1.);void main(){vec2 a=vv0-u7*h;vec4 b=texture2D(u3,a),c=texture2D(u3,a+u7*i),d=texture2D(u3,a+u7*j),k=texture2D(u3,a+u7),l=e(b,c),g=e(d,k);gl_FragColor=e(l,g);}",
f:["u3","u7"],h:A},s33:{c:"uniform sampler2D u3;uniform vec2 u7;varying vec2 vv0;const vec2 j=vec2(1.,0.),k=vec2(0.,1.),l=vec2(2.,0.),m=vec2(0.,2.);vec4 e(vec4 a,vec4 b){vec4 c=step(a,b);return mix(a,b,c);}vec4 f(vec2 a){vec4 b=texture2D(u3,a),c=texture2D(u3,a+u7*j),d=texture2D(u3,a+u7*k),g=texture2D(u3,a+u7),i=e(b,c),h=e(d,g);return e(i,h);}void main(){vec2 a=vv0+u7*vec2(-.55,-1.05);vec4 b=f(a),c=f(a+u7*l),d=f(a+u7*2.),g=f(a+u7*m),i=e(b,c),h=e(d,g);gl_FragColor=e(i,h);}",f:["u3","u7"],h:A},s34:{c:"uniform sampler2D u1;varying vec2 vv0;void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=a*a;}",
f:["u1"],h:q,precision:"lowp"},s35:{c:"uniform sampler2D u1;uniform vec2 u7;varying vec2 vv0;const vec4 g=vec4(1.,1.,1.,1.);const float d=15444.;void main(){vec4 a=1001./d*texture2D(u1,vv0-3.*u7)+2002./d*texture2D(u1,vv0-2.*u7)+3003./d*texture2D(u1,vv0-u7)+3432./d*texture2D(u1,vv0)+3003./d*texture2D(u1,vv0+u7)+2002./d*texture2D(u1,vv0+2.*u7)+1001./d*texture2D(u1,vv0+3.*u7);gl_FragColor=a;}",f:["u7","u1"],h:q,precision:"lowp"},s36:{c:"uniform sampler2D u1,u29,u30;varying vec2 vv0;const vec4 g=vec4(1.,1.,1.,1.);const float h=.1;void main(){vec4 a=texture2D(u29,vv0),b=texture2D(u30,vv0),c=texture2D(u1,vv0),d=max(g*h,b-a*a),f=sqrt(d);gl_FragColor=(c-a)/f;}",
f:["u1","u29","u30"],h:{u1:0,u29:1,u30:2}}},F={s37:{c:"uniform float u18,u31;uniform sampler2D u15,u16,u23;varying vec2 vv0;const vec2 ZERO2=vec2(0.,0.),ONE2=vec2(1.,1.),HALF2=vec2(.5,.5),EPS2=vec2(.01,.01);void main(){vec4 sum=texture2D(u23,vv0);float toSparsity=1.1111;vec2 uvFrom,uvWeight,xyPatch=ZERO2,eps2=EPS2/u18,xyTo=floor(vv0*u18+eps2);float weightSize=toSparsity*u18;vec2 halfFromSparsity=ONE2*(toSparsity-1.)/2.;for(float patch_x=0.;patch_x<1.1111;patch_x+=1.){xyPatch.x=patch_x;for(float patch_y=0.;patch_y<1.1111;patch_y+=1.)xyPatch.y=patch_y,uvFrom=(xyTo+HALF2+u31*(xyPatch-halfFromSparsity))/u18,uvFrom+=step(uvFrom,-eps2),uvFrom-=step(ONE2-eps2,uvFrom),uvWeight=(xyTo*toSparsity+xyPatch+HALF2)/weightSize,sum+=texture2D(u15,uvWeight)*texture2D(u16,uvFrom);}gl_FragColor=sum,gl_FragColor*=2.2222;}",
f:["u18","u15","u16","u23","u31"],qa:["1.1111","gl_FragColor\\*=2.2222;"]},s38:{c:"uniform float u18,u31,u26;uniform sampler2D u15,u16,u23;varying vec2 vv0;const vec2 ZERO2=vec2(0.,0.),ONE2=vec2(1.,1.),HALF2=vec2(.5,.5),EPS2=vec2(.01,.01);void main(){vec4 sum=texture2D(u23,vv0);float fromSparsity=1.1111,shrinkFactor=3.3333;vec2 uvFrom,uvWeight,xyFrom,xyPatchTo,xyPatch=ZERO2,xyShrink=ZERO2,eps2=EPS2/u26,xyTo=floor(vv0*u18+eps2);float weightSize=fromSparsity*u26;vec2 halfFromSparsity=ONE2*(fromSparsity-1.)/2.;float toSparsity=weightSize/u18;vec2 xyFrom0=xyTo*shrinkFactor;for(float patch_x=0.;patch_x<1.1111;patch_x+=1.){xyPatch.x=patch_x;for(float patch_y=0.;patch_y<1.1111;patch_y+=1.){xyPatch.y=patch_y;for(float shrink_x=0.;shrink_x<3.3333;shrink_x+=1.){xyShrink.x=shrink_x;for(float shrink_y=0.;shrink_y<3.3333;shrink_y+=1.)xyShrink.y=shrink_y,xyFrom=xyFrom0+xyShrink+shrinkFactor*u31*(xyPatch-halfFromSparsity),uvFrom=(xyFrom+HALF2)/u26,uvFrom+=step(uvFrom,-eps2),uvFrom-=step(ONE2-eps2,uvFrom),xyPatchTo=xyPatch*shrinkFactor+xyShrink,uvWeight=(xyTo*toSparsity+xyPatchTo+HALF2)/weightSize,sum+=texture2D(u15,uvWeight)*texture2D(u16,uvFrom);}}}gl_FragColor=sum,gl_FragColor*=2.2222;}",
f:"u18 u26 u15 u16 u23 u31".split(" "),qa:["1.1111","gl_FragColor\\*=2.2222;","3.3333"]}},C={Ja:function(){return m},i:function(){if(!m){r="highp";for(var a in B)d(B[a],a);p.set("s0");l.enableVertexAttribArray(0);a=za.i();m=!0;return a}},Pb:function(a){a.forEach(function(a){C.Va(a)})},Va:function(a){B[a.id]=a;d(a,a.id)},lb:function(a,b,e){b||(b=a);B[b]=Object.create(F[a]);F[a].qa&&F[a].qa.forEach(function(a,d){B[b].c=B[b].c.replace(new RegExp(a,"g"),e[d])});d(B[b],b)},set:function(a){e(B[a])},jc:function(a){return"undefined"!==
typeof B[a]},wd:function(){return f.td},M:function(){-1!==g&&(g=-1,f.W.forEach(function(a){0!==a&&l.disableVertexAttribArray(a)}))},Oa:function(){var a=0;f.W.forEach(function(b,d){d=f.V[d];l.vertexAttribPointer(b,d,l.FLOAT,!1,f.Ra,a);a+=4*d})},sd:function(){l.enableVertexAttribArray(0)},Pa:function(){l.vertexAttribPointer(f.W[0],2,l.FLOAT,!1,8,0)},Yd:function(a,b){l.uniform1i(f.l[a],b)},A:function(a,b){l.uniform1f(f.l[a],b)},I:function(a,b,d){l.uniform2f(f.l[a],b,d)},Zd:function(a,b){l.uniform2fv(f.l[a],
b)},$d:function(a,b){l.uniform3fv(f.l[a],b)},Gb:function(a,b,d,e){l.uniform3f(f.l[a],b,d,e)},Hb:function(a,b){l.uniform4fv(f.l[a],b)},ae:function(a,b){l.uniformMatrix2fv(f.l[a],!1,b)},be:function(a,b){l.uniformMatrix3fv(f.l[a],!1,b)},ce:function(a,b){l.uniformMatrix4fv(f.l[a],!1,b)},G:function(a,b){C.set(a);b.forEach(function(a){switch(a.type){case "4f":l.uniform4fv(f.l[a.name],a.value);break;case "3f":l.uniform3fv(f.l[a.name],a.value);break;case "2f":l.uniform2fv(f.l[a.name],a.value);break;case "1f":l.uniform1f(f.l[a.name],
a.value);break;case "1i":l.uniform1i(f.l[a.name],a.value);break;case "mat2":l.uniformMatrix2fv(f.l[a.name],!1,a.value);break;case "mat3":l.uniformMatrix3fv(f.l[a.name],!1,a.value);break;case "mat4":l.uniformMatrix4fv(f.l[a.name],!1,a.value)}})}};return C}(),l=!1,Aa=function(){function a(a){console.log("ERROR in ContextFeedForward : ",a);return!1}var b=!1,d=!1,e=!1,g=!1,f=!0,k=!1,m={s:function(){return b.width},D:function(){return b.height},ia:function(){return b},vd:function(){return l},m:function(){return f},
flush:function(){l.flush()},nc:function(){k||(k=new Uint8Array(b.width*b.height*4));l.readPixels(0,0,b.width,b.height,l.RGBA,l.UNSIGNED_BYTE,k);return k},yd:function(){return b.toDataURL("image/jpeg")},zd:function(){w.C();d||(d=document.createElement("canvas"),e=d.getContext("2d"));d.width=b.width;d.height=b.height;var a=m.nc(),f=e.createImageData(d.width,d.height),g,k,n=d.width,u=d.height,A=f.data;for(k=0;k<u;++k){var B=u-k-1;for(g=0;g<n;++g){var F=4*(k*n+g);var C=4*(B*n+g);A[F]=a[C];A[F+1]=a[C+
1];A[F+2]=a[C+2];A[F+3]=a[C+3]}}e.putImageData(f,0,0);return d.toDataURL("image/png")},xd:function(a){!d&&a&&(d=document.createElement("canvas"),e=d.getContext("2d"));var f=a?d:document.createElement("canvas");f.width=b.width;f.height=b.height;(a?e:f.getContext("2d")).drawImage(b,0,0);return f},i:function(d){d.eb&&!d.ga_?b=document.getElementById(d.eb):d.ga_&&(b=d.ga_);b||(b=document.createElement("canvas"));b.width=d&&void 0!==d.width?d.width:512;b.height=d&&void 0!==d.height?d.height:512;"undefined"===
typeof d&&(d={});void 0===d.premultipliedAlpha&&(d.premultipliedAlpha=!1);void 0===d.Ia&&(d.Ia=!0);void 0===d.antialias&&(d.antialias=!1);var e={antialias:d.antialias,alpha:!0,preserveDrawingBuffer:!0,premultipliedAlpha:d.premultipliedAlpha,stencil:!1,depth:d.Ia},k;if(k=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)k=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),k=12===parseInt(k[1],10);k||(l=b.getContext("webgl2",e));l?f=!0:((l=b.getContext("webgl",e))||(l=b.getContext("experimental-webgl",
e)),f=!1);if(!l)return a("WebGL is not enabled");(g=l.getExtension("WEBGL_lose_context"))&&b.addEventListener("webglcontextlost",d.Nc,!1);if(!x.i())return a("Not enough capabilities");if(!x.Xb()&&f)return a("Your configuration cannot process color buffer float");l.clearColor(0,0,0,0);l.disable(l.DEPTH_TEST);l.disable(l.BLEND);l.disable(l.DITHER);l.disable(l.STENCIL_TEST);l.GENERATE_MIPMAP_HINT&&l.hint(l.GENERATE_MIPMAP_HINT,l.FASTEST);l.disable(l.SAMPLE_ALPHA_TO_COVERAGE);l.disable(l.SAMPLE_COVERAGE);
return!0},Id:function(){if(!p.i())return!1;l.depthFunc(l.LEQUAL);l.clearDepth(1);return!0}};return m}(),ya=function(){var a="undefined"===typeof p?JEShaders:p;return{Zc:function(b){a!==b&&(a.M(),a=b)},Ja:function(){return a.Ja()},Pa:function(){a.Pa()},Oa:function(){a.Oa()},M:function(){a.M()},set:function(b){a.set(b)}}}(),z=function(){var a,b,d=0,e=-2,g=-2,f=!1,k={reset:function(){g=e=-2},i:function(){f||(a=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,a),l.bufferData(l.ARRAY_BUFFER,new Float32Array([-1,
-1,3,-1,-1,3]),l.STATIC_DRAW),b=l.createBuffer(),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,b),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2]),l.STATIC_DRAW),k.ya(),f=!0)},a:function(a){var b=d++,f=a.R.length,k=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,k);l.bufferData(l.ARRAY_BUFFER,a.Lb instanceof Float32Array?a.Lb:new Float32Array(a.Lb),l.STATIC_DRAW);e=b;if(a.R){var m=l.createBuffer();l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,m);if(65536>a.R.length){var n=Uint16Array;var u=l.UNSIGNED_SHORT;
var A=2}else n=Uint32Array,u=l.UNSIGNED_INT,A=4;l.bufferData(l.ELEMENT_ARRAY_BUFFER,a.R instanceof n?a.R:new n(a.R),l.STATIC_DRAW);g=b}var B={Wb:function(a){e!==b&&(l.bindBuffer(l.ARRAY_BUFFER,k),e=b);a&&ya.Oa()},Ub:function(){g!==b&&(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,m),g=b)},bind:function(a){B.Wb(a);B.Ub()},qd:function(){l.drawElements(l.TRIANGLES,f,u,0)},rd:function(a,b){l.drawElements(l.TRIANGLES,a,u,b*A)},remove:function(){l.deleteBuffer(k);a.R&&l.deleteBuffer(m);B=null}};return B},ya:function(){-1!==
e&&(l.bindBuffer(l.ARRAY_BUFFER,a),e=-1);-1!==g&&(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,b),g=-1)},g:function(a,b){a&&z.ya();b&&ya.Pa();l.drawElements(l.TRIANGLES,3,l.UNSIGNED_SHORT,0)},mc:function(){l.deleteBuffer(a);l.deleteBuffer(b)}};return k}(),w=function(){var a,b,d,e=!1,g={o:-2,kc:1};return{i:function(){if(!e){a=l.createFramebuffer();var f=x.m();b=f&&l.DRAW_FRAMEBUFFER?l.DRAW_FRAMEBUFFER:l.FRAMEBUFFER;d=f&&l.READ_FRAMEBUFFER?l.READ_FRAMEBUFFER:l.FRAMEBUFFER;e=!0}},Bd:function(){return b},Da:function(){return d},
O:function(){return l.FRAMEBUFFER},Dd:function(){return g},ud:function(){return a},a:function(d){void 0===d.mb&&(d.mb=!1);var e=d.dd?d.dd:!1,f=d.width,r=void 0!==d.height?d.height:d.width,h=a,t=!1,q=!1,n=0;e&&(f=f?f:e.s(),r=r?r:e.D());var u={Eb:function(){q||(h=l.createFramebuffer(),q=!0,n=g.kc++)},Ob:function(){u.Eb();u.j();t=l.createRenderbuffer();l.bindRenderbuffer(l.RENDERBUFFER,t);l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,r);l.framebufferRenderbuffer(b,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,
t);l.clearDepth(1)},bind:function(a,d){n!==g.o&&(l.bindFramebuffer(b,h),g.o=n);e&&e.j();d&&l.viewport(0,0,f,r);a&&l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT)},kd:function(){n!==g.o&&(l.bindFramebuffer(b,h),g.o=n)},clear:function(){l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT)},nd:function(){l.clear(l.COLOR_BUFFER_BIT)},od:function(){l.clear(l.DEPTH_BUFFER_BIT)},$c:function(){l.viewport(0,0,f,r)},j:function(){n!==g.o&&(l.bindFramebuffer(b,h),g.o=n)},rtt:function(a){e=a;g.o!==n&&(l.bindFramebuffer(l.FRAMEBUFFER,
h),g.o=n);a.j()},C:function(){l.bindFramebuffer(b,null);g.o=-1},resize:function(a,b){f=a;r=b;t&&(l.bindRenderbuffer(l.RENDERBUFFER,t),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,r))},remove:function(){l.bindFramebuffer(b,h);l.framebufferTexture2D(b,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,null,0);t&&l.framebufferRenderbuffer(b,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,null);l.bindFramebuffer(b,null);l.deleteFramebuffer(h);t&&l.deleteRenderbuffer(t);u=null}};d.mb&&u.Ob();return u},C:function(){l.bindFramebuffer(b,
null);g.o=-1},fd:function(){l.bindFramebuffer(b,null);l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT);l.viewport(0,0,x.s(),x.D());g.o=-1},reset:function(){g.o=-2},H:function(){0!==g.o&&(l.bindFramebuffer(b,a),g.o=0)},clear:function(){l.viewport(0,0,x.s(),x.D());l.clear(l.COLOR_BUFFER_BIT)}}}(),I=function(){function a(a){l.bindTexture(l.TEXTURE_2D,a)}function b(a){M[0]=a;a=Z[0];var b=a>>16&32768,d=a>>12&2047,E=a>>23&255;return 103>E?b:142<E?b|31744|((255==E?0:1)&&a&8388607):113>E?(d|=2048,b|(d>>114-
E)+(d>>113-E&1)):b=(b|E-112<<10|d>>1)+(d&1)}function d(a){var d=new Uint16Array(a.length);a.forEach(function(a,E){d[E]=b(a)});return d}function e(){if(null!==Q.Ea)return Q.Ea;var a=f(d([1,1,1,1]));return null===a?!0:Q.Ea=a}function g(){if(null!==Q.Fa)return Q.Fa;var a=f(new Uint8Array([255,255,255,255]));return null===a?!0:Q.Fa=a}function f(a){if(!ya.Ja()||!A)return null;a=K.a({isFloat:!1,B:!0,array:a,width:1});w.C();l.viewport(0,0,1,1);l.clearColor(0,0,0,0);l.clear(l.COLOR_BUFFER_BIT);ya.set("s0");
a.$a(0);z.g(!1,!0);var b=new Uint8Array(4);l.readPixels(0,0,1,1,l.RGBA,l.UNSIGNED_BYTE,b);b=.9<b[0];a.remove();w.H();return b}var k=0,m,r=0,h,t=!1,q,n,u,A=!1,B=!1,F,C,G,X=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],da=!1,ha=!1,M=new Float32Array(1),Z=new Int32Array(M.buffer),Q={Ea:null,Fa:null},K={i:function(){if(!A){n=[l.RGB,!1,l.RGB,l.RGBA];u=[l.RGB,!1,l.RGB,l.RGBA];m=[l.TEXTURE0,l.TEXTURE1,l.TEXTURE2,l.TEXTURE3,l.TEXTURE4,l.TEXTURE5,l.TEXTURE6,l.TEXTURE7];da="undefined"!==typeof JEContext;ha="undefined"!==
typeof x;da&&JEContext.Qd()&&m.push(l.TEXTURE8,l.TEXTURE9);h=[-1,-1,-1,-1,-1,-1,-1,-1];q=[l.UNSIGNED_BYTE,l.FLOAT,l.FLOAT];if(!t){for(var a=new Float32Array(16384),b=0;16384>b;++b)a[b]=2*Math.random()-1;t={random:K.a({isFloat:!0,isPot:!0,array:a,width:64}),Kb:K.a({isFloat:!1,isPot:!0,width:1,array:new Uint8Array([0,0,0,0])})}}A=!0}},wc:function(){K.gd()},Gd:function(){return t.Kb},gd:function(){q[1]=x.ja()},Vc:function(){u=n=[l.RGBA,l.RGBA,l.RGBA,l.RGBA]},Qc:function(a,b){p.set("s1");w.C();var d=
a.s(),E=a.D();l.viewport(0,0,d,E);a.b(0);z.g(!1,!1);l.readPixels(0,0,d,E,l.RGBA,l.UNSIGNED_BYTE,b)},lc:function(b,d,e){l.activeTexture(l.TEXTURE0);k=0;var E=l.createTexture();a(E);var f=x.m()&&l.RGBA32F?l.RGBA32F:l.FLOAT;d=d instanceof Float32Array?d:new Float32Array(d);var g=Math.log(d.length)/Math.log(2);g!==Math.floor(g)&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE));l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,
l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,e);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,b.s(),b.D(),0,l.RGBA,f,d);a(null);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1);w.H();p.set("s0");b.u();l.clearColor(0,0,0,0);l.clear(l.COLOR_BUFFER_BIT);a(E);z.g(!0,!1);l.deleteTexture(E)},a:function(b){function f(){a(O);ea&&l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,ea);b.isPot?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,b.ob?l.MIRRORED_REPEAT:l.REPEAT),l.texParameteri(l.TEXTURE_2D,
l.TEXTURE_WRAP_T,b.J?l.MIRRORED_REPEAT:l.REPEAT)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE));b.la&&"undefined"!==typeof JESETTINGS&&l.texParameterf(l.TEXTURE_2D,JEContext.Ad().TEXTURE_MAX_ANISOTROPY_EXT,JESETTINGS.jd);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,b.isLinear?l.LINEAR:l.NEAREST);b.isLinear?l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,b.isMipmap&&!ka?l.NEAREST_MIPMAP_LINEAR:l.LINEAR):l.texParameteri(l.TEXTURE_2D,
l.TEXTURE_MIN_FILTER,b.isMipmap&&!ka?l.NEAREST_MIPMAP_NEAREST:l.NEAREST);W=n[b.$-1];P=u[b.$-1];Y=q[t];if(x.m()){var d=l.RGBA32F;W===l.RGBA&&Y===l.FLOAT&&d&&(P=d);W===l.RGB&&Y===l.FLOAT&&d&&(P=d,W=l.RGBA)}if(b.B&&!b.isFloat||b.isFloat&&b.isMipmap&&za.zc())(d=l.RGBA16F)&&(P=d),Y=x.ja();b.rb&&"undefined"!==typeof l.texStorage2D&&(va=b.rb);b.pb&&4===b.$&&(W=JEContext.Ed());if(b.v)l.texImage2D(l.TEXTURE_2D,0,P,W,Y,b.v);else if(b.url)l.texImage2D(l.TEXTURE_2D,0,P,W,Y,ca);else if(L){try{l.texImage2D(l.TEXTURE_2D,
0,P,y,v,0,W,Y,L),l.getError()!==l.NO_ERROR&&(l.texImage2D(l.TEXTURE_2D,0,P,y,v,0,W,Y,null),l.getError()!==l.NO_ERROR&&l.texImage2D(l.TEXTURE_2D,0,l.RGBA,y,v,0,l.RGBA,l.UNSIGNED_BYTE,null))}catch(fb){l.texImage2D(l.TEXTURE_2D,0,P,y,v,0,W,Y,null)}b.isKeepArray||(L=null)}else l.texImage2D(l.TEXTURE_2D,0,P,y,v,0,W,Y,null);if(b.isMipmap)if(!ka&&D)D.Ca(),wa=!0;else if(ka){d=Math.log(Math.min(y,v))/Math.log(2);var e;ma=Array(1+d);ma[0]=O;for(e=1;e<=d;++e){var f=Math.pow(2,e);var g=y/f;f=v/f;var m=l.createTexture();
a(m);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);l.texImage2D(l.TEXTURE_2D,0,P,g,f,0,W,Y,null);a(null);ma[e]=m}wa=!0}a(null);h[k]=-1;ea&&l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1);ia=!0;N&&D&&(N(D),N=!1)}"undefined"===typeof b.isFloat&&(b.isFloat=!1);"undefined"===typeof b.B&&(b.B=!1);"undefined"===typeof b.isPot&&(b.isPot=!0);"undefined"===typeof b.isLinear&&(b.isLinear=!1);"undefined"===typeof b.isMipmap&&(b.isMipmap=!1);
"undefined"===typeof b.za&&(b.za=!1);void 0===b.la&&(b.la=!1);void 0===b.J&&(b.J=!1);void 0===b.ob&&(b.ob=!1);void 0===b.pb&&(b.pb=!1);void 0===b.$&&(b.$=4);void 0===b.nb&&(b.nb=!1);"undefined"===typeof b.isFlipY&&(b.isFlipY=b.url||b.array?!0:!1);"undefined"===typeof b.isKeepArray&&(b.isKeepArray=!1);b.data&&(b.array="string"===typeof b.data?xa(b.data):b.isFloat?new Float32Array(b.data):new Uint8Array(b.data),b.isFlipY=!1);var t=0,E=b.v?!0:!1,A=null,S=null,T=!1,Q=null;b.isFloat&&(b.B=!0);b.B&&(t=
1);b.nb||x.m()||!b.isFloat||!ha||x.bb()||(b.isFloat=!1);b.isFloat&&(t=2);b.la&&da&&!JEContext.Ld()&&(b.la=!1);var O=l.createTexture(),N=b.za,ca=null,L=!1,y=0,v=0,ia=!1,R=r++,H=!1,U,M,Z,pa,P,W,Y,ea=b.isFlipY,ka=b.B&&b.isMipmap&&"undefined"!==typeof za&&!za.Zb()?!0:!1,ma,va=-1,wa=!1;"undefined"!==typeof b.width&&b.width&&(y=b.width,v="undefined"!==typeof b.height&&b.height?b.height:y);var D={get:function(){return O},s:function(){return y},D:function(){return v},Hd:function(){return b.url},Md:function(){return b.isFloat},
Od:function(){return b.B},Pd:function(){return b.isLinear},Ca:function(){l.generateMipmap(l.TEXTURE_2D)},ab:function(b,d){ka?(b||(b=D.hb()),D.xa(d),a(ma[b]),h[d]=-1):D.b(d)},hb:function(){-1===va&&(va=Math.log(y)/Math.log(2));return va},gb:function(b){if(ka){b||(b=D.hb());p.set("s11");D.xa(0);var d,e=y,f=v;for(d=1;d<=b;++d)e/=2,f/=2,p.I("u7",.25/e,.25/f),l.viewport(0,0,e,f),a(ma[d-1]),l.framebufferTexture2D(w.O(),l.COLOR_ATTACHMENT0,l.TEXTURE_2D,ma[d],0),z.g(!1,1===d);h[0]=-1}else D.Ca()},xa:function(a){a!==
k&&(l.activeTexture(m[a]),k=a)},b:function(b){if(!ia)return!1;D.xa(b);if(h[b]===R)return!1;a(O);h[b]=R;return!0},$a:function(b){l.activeTexture(m[b]);k=b;a(O);h[b]=R},j:function(){l.framebufferTexture2D(w.O(),l.COLOR_ATTACHMENT0,l.TEXTURE_2D,O,0)},u:function(){l.viewport(0,0,y,v);l.framebufferTexture2D(w.O(),l.COLOR_ATTACHMENT0,l.TEXTURE_2D,O,0)},fe:function(){l.framebufferTexture2D(w.O(),l.COLOR_ATTACHMENT0,l.TEXTURE_2D,null,0)},resize:function(a,b){y=a;v=b;f()},clone:function(a){a=K.a({width:y,
height:v,B:b.B,isFloat:b.isFloat,isLinear:b.isLinear,J:b.J,isFlipY:a?!ea:ea,isPot:b.isPot});ya.set("s0");w.H();a.j();l.viewport(0,0,y,v);D.b(0);z.g(!0,!0);return a},$c:function(){l.viewport(0,0,y,v)},remove:function(){l.deleteTexture(O);D=null},refresh:function(){D.$a(0);ea&&l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0);E?l.texImage2D(l.TEXTURE_2D,0,P,W,l.UNSIGNED_BYTE,b.v):l.texImage2D(l.TEXTURE_2D,0,P,y,v,0,W,Y,L);ea&&l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1)},cb:function(){var a=y*v*4;M=[new Uint8Array(a),
new Uint8Array(a),new Uint8Array(a),new Uint8Array(a)];U=[new Float32Array(M[0].buffer),new Float32Array(M[1].buffer),new Float32Array(M[2].buffer),new Float32Array(M[3].buffer)];Z=new Uint8Array(4*a);pa=new Float32Array(Z.buffer);H=!0},Na:function(){H||D.cb();l.readPixels(0,0,y,4*v,l.RGBA,l.UNSIGNED_BYTE,Z);var a,b=y*v,d=2*b,e=3*b;for(a=0;a<b;++a)U[0][a]=pa[a],U[1][a]=pa[a+b],U[2][a]=pa[a+d],U[3][a]=pa[a+e];return U},Aa:function(){w.C();p.set("s12");D.b(0);for(var a=0;4>a;++a)l.viewport(0,v*a,y,
v),p.Hb("u8",X[a]),z.g(!1,0===a)},ge:function(b){var d=Y===q[0]&&!g();a(O);ea&&l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,ea);d?(T||(A=document.createElement("canvas"),A.width=y,A.height=v,S=A.getContext("2d"),Q=S.createImageData(y,v),T=!0),Q.data.set(b),S.putImageData(Q,0,0),l.texImage2D(l.TEXTURE_2D,0,P,W,Y,A)):l.texImage2D(l.TEXTURE_2D,0,P,y,v,0,W,Y,b);h[k]=R;ea&&l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1)},he:function(b,d){a(O);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,d);l.texImage2D(l.TEXTURE_2D,0,P,W,Y,b);
h[k]=R;d&&l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1)},Ud:function(a,d){var e=y*v,f=4*e;a=b.B?a?"RGBE":"JSON":"RGBA";d&&(a=d);d=x.m()&&!1;switch(a){case "RGBE":var g="s39";break;case "JSON":g=d?"s0":"s12";break;case "RGBA":case "RGBAARRAY":g="s6"}H||("RGBA"===a||"RGBE"===a||"RGBAARRAY"===a?(M=new Uint8Array(f),H=!0):"JSON"!==a||d||D.cb());w.C();p.set(g);D.b(0);if("RGBA"===a||"RGBE"===a||"RGBAARRAY"===a){l.viewport(0,0,y,v);z.g(!0,!0);l.readPixels(0,0,y,v,l.RGBA,l.UNSIGNED_BYTE,M);if("RGBAARRAY"===a)return{data:M};
B||(F=document.createElement("canvas"),C=F.getContext("2d"),B=!0);F.width=y;F.height=v;G=C.createImageData(y,v);G.data.set(M);C.putImageData(G,0,0);var k=F.toDataURL("image/png")}else if("JSON"===a)if(d)k=new Float32Array(e),l.viewport(0,0,y,v),z.g(!0,!0),l.readPixels(0,0,y,v,l.RGBA,l.FLOAT,k);else{for(k=0;4>k;++k)l.viewport(0,v*k,y,v),p.Hb("u8",X[k]),z.g(!k,!k);D.Na();k=Array(e);for(g=0;g<e;++g)k[4*g]=U[0][g],k[4*g+1]=U[1][g],k[4*g+2]=U[2][g],k[4*g+3]=U[3][g]}return{format:a,data:k,width:y,height:v,
isMirrorY:b.J,isFlipY:"RGBA"===a?b.isFlipY:!b.isFlipY}}};b.isMipmap&&!ka&&ia&&!wa&&(D.Ca(),wa=!0);if(b.url)a(O),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,1,1,0,l.RGBA,l.UNSIGNED_BYTE,null),ca=new Image,ca.pd="Anonymous",ca.crossOrigin="Anonymous",ca.src=b.url,ca.onload=function(){y=ca.width;v=ca.height;f()};else if(b.v){var Ea=function(){y=void 0!==b.v.videoWidth?b.v.videoWidth:b.v.width;v=void 0!==b.v.videoHeight?b.v.videoHeight:b.v.height;y?f():setTimeout(Ea,1)};Ea()}else b.array?(b.B&&!b.isFloat?b.array instanceof
Uint16Array?(L=b.array,f()):e()?(L=d(b.array),f()):(f(),K.lc(D,b.array,ea)):(L=b.isFloat?b.array instanceof Float32Array?b.array:new Float32Array(b.array):b.array instanceof Uint8Array?b.array:new Uint8Array(b.array),f()),b.isKeepArray||(L&&L!==b.array&&(L=null),delete b.array)):f();D.tc=D.s;N&&ia&&(N(D),N=!1);return D},C:function(b){b!==k&&(l.activeTexture(m[b]),k=b);h[b]=-1;a(null)},ld:function(a){t.random.b(a)},reset:function(){for(var a=0;a<m.length;++a)h[a]=-1;k=-1},Td:function(){k=-1},de:function(){for(var a=
0;a<m.length;++a)K.C(a)},mc:function(){t&&(t.random.remove(),t.Kb.remove())},ee:function(a,b){if("RGBA"===a.format||"RGBE"===a.format){var d=new Image;d.src=a.data;d.onload=function(){K.a({J:a.isMirrorY,isFlipY:a.isFlipY,isFloat:!1,v:d,za:function(d){if("RGBA"===a.format)b(d);else{var e=a.width,f=a.height,g=K.a({J:a.isMirrorY,isFloat:!0,width:e,height:f,isFlipY:a.isFlipY});w.H();l.viewport(0,0,e,f);p.set("s40");g.j();d.b(0);z.g(!0,!0);K.C(0);b(g);l.flush();setTimeout(d.remove,50)}}})}}else"JSON"===
a.format?b(K.a({isFloat:!0,isFlipY:a.isFlipY,width:a.width,height:a.height,array:new Float32Array(a.data)})):b(!1)}};return K}(),Ba={a:function(a){var b=[I.a(a),I.a(a)],d=[b[1],b[0]],e=d,g={Fb:function(a){e[1].j();e[0].b(a);g.Jb()},Xd:function(a){e[1].u();e[0].b(a);g.Jb()},Jb:function(){e=e===b?d:b},refresh:function(){e[0].refresh();e[1].refresh()},b:function(a){e[0].b(a)},oc:function(){return e[0]}};return g}},x=function(){function a(){b="undefined"===typeof Aa?JEContext:Aa;d=!0}var b,d=!1,e=!1,
g=!1,f=!1,k=!1,m=!1,r=!1,h=!1,t=!1,q=!1,n=!1,u=!0,A=!0,B=!0,F,C="undefined"===typeof window?{}:window,G={i:function(){if(d)return!0;a();G.fb();G.Ba();G.hc();G.ic();w.i();I.i();if(!G.cc())return!1;z.i();I.wc();return!0},s:function(){d||a();return b.s()},D:function(){d||a();return b.D()},m:function(){d||a();return b.m()},hc:function(){n=(q=l.getExtension("EXT_color_buffer_float")||l.getExtension("WEBGL_color_buffer_float")||l.getExtension("OES_color_buffer_float"))?!0:!1;C.GL_EXT_COLORBUFFERFLOAT=q},
ic:function(){l.getExtension("EXT_color_buffer_half_float")||l.getExtension("WEBGL_color_buffer_half_float")||l.getExtension("OES_color_buffer_half_float")},fb:function(){if(!e){this.m()||(g=l.getExtension("OES_texture_float")||l.getExtension("MOZ_OES_texture_float")||l.getExtension("WEBKIT_OES_texture_float"),k=(C.GL_EXT_FLOAT=g)?!0:!1);if(k||this.m())f=l.getExtension("OES_texture_float_linear")||l.getExtension("MOZ_OES_texture_float_linear")||l.getExtension("WEBKIT_OES_texture_float_linear"),C.GL_EXT_FLOATLINEAR=
f;e=!0}},Ba:function(){if(!t){if(!this.m()){if(m=l.getExtension("OES_texture_half_float")||l.getExtension("MOZ_OES_texture_half_float")||l.getExtension("WEBKIT_OES_texture_half_float"))F=m.HALF_FLOAT_OES,r=!0;C.GL_EXT_HALFFLOAT=m}if(r||this.m())h=l.getExtension("OES_texture_half_float_linear")||l.getExtension("MOZ_OES_texture_half_float_linear")||l.getExtension("WEBKIT_OES_texture_half_float_linear"),C.GL_EXT_HALFFLOATLINEAR=h;t=!0}},ja:function(){if(G.m())return l.HALF_FLOAT;G.Ba();return r?F:l.FLOAT},
bb:function(){return u},Yb:function(){return A},md:function(){return B},Xb:function(){return n},ec:function(){A=u=!0;var a=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,a);var b=l.createTexture();l.bindTexture(l.TEXTURE_2D,b);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texImage2D(l.TEXTURE_2D,0,G.m()&&l.RGBA32F?l.RGBA32F:l.RGBA,1,1,0,l.RGBA,l.FLOAT,null);l.framebufferTexture2D(w.O(),l.COLOR_ATTACHMENT0,l.TEXTURE_2D,
b,0);var d=l.checkFramebufferStatus(w.Da());d!==l.FRAMEBUFFER_COMPLETE&&(u=!1);l.texImage2D(l.TEXTURE_2D,0,G.m()&&l.RGBA16F?l.RGBA16F:l.RGBA,1,1,0,l.RGBA,G.ja(),null);l.framebufferTexture2D(w.O(),l.COLOR_ATTACHMENT0,l.TEXTURE_2D,b,0);d=l.checkFramebufferStatus(w.Da());d!==l.FRAMEBUFFER_COMPLETE&&(A=!1);l.bindTexture(l.TEXTURE_2D,null);l.bindFramebuffer(l.FRAMEBUFFER,null);l.deleteTexture(b);l.deleteFramebuffer(a)},dc:function(){var a=w.a({width:1});a.Eb();var b=I.a({width:1,isFloat:!0,$:3});a.j();
b.j();l.flush();l.checkFramebufferStatus(w.Da())!==l.FRAMEBUFFER_COMPLETE?(I.Vc(),B=!1):B=!0;a.remove();b.remove()},cc:function(){G.ec();if(!u&&!A)return!1;G.dc();return!0}};return G}(),za=function(){var a=!1,b=[.8,1,.8,1],d=0,e,g=new Uint8Array(4),f=b.concat(b,b,b),k=!0,m={i:function(){function b(a,b,d,e){l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e?l.NEAREST_MIPMAP_NEAREST:l.LINEAR);try{var f=l.getError();f!==l.NO_ERROR&&console.log("GLERR in test_mipmapping() :",f);l.texImage2D(l.TEXTURE_2D,
0,a,2,2,0,l.RGBA,b,d);f=l.getError();if(f!==l.NO_ERROR)return!1}catch(X){return!1}e&&l.generateMipmap(l.TEXTURE_2D);z.ya();z.g(!1,!0);l.readPixels(0,0,1,1,l.RGBA,l.UNSIGNED_BYTE,g);f=l.getError();f===l.INVALID_OPERATION&&"undefined"!==typeof l.PIXEL_PACK_BUFFER&&(l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.readPixels(0,0,1,1,l.RGBA,l.UNSIGNED_BYTE,g),f=l.getError());return f!==l.NO_ERROR?!1:0!==g[0]}function h(a){return x.bb()&&b(q,l.FLOAT,new Float32Array(f),a)?(d=3,!0):!1}function m(a){return x.Yb()?
b(n,x.ja(),new Uint16Array(f),a)||b(n,l.FLOAT,new Float32Array(f),a)?(d=2,!0):!1:!1}x.fb();x.Ba();var q=l.RGBA,n=l.RGBA;if(Aa.m()){var u=l.RGBA32F;u&&(q=u);(u=l.RGBA16F)&&(n=u)}z.i();w.reset();w.C();l.viewport(0,0,1,1);p.set("s0");a=!0;e=l.createTexture();l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,e);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);if(m(!0)||h(!0))return!0;
k=!1;if(m(!1)||h(!1))return!0;if(Aa.m()){n=q=l.RGBA;if(m(!0)||h(!0))return!0;k=!1;if(m(!1)||h(!1))return!0}return!1},Zb:function(){return k},Cd:function(){return d},Nd:function(){a||m.i();return 3===d},zc:function(){a||m.i();return 2===d}};return m}(),Fa={a:function(a){var b=I.a(a.alpha),d=I.a(a.beta);return{gc:function(){b.b(1);d.b(2)}}}},Ia={a:function(a){var b=a.bd;b.index=a.index;b.K=a.K;b.parent=a.parent;switch(b.type){case "input":a=Ga.a(b);break;default:a=Ha.a(b)}return a}},Ga={a:function(a){"undefined"===
typeof a.sift&&(a.sift=!1);"undefined"===typeof a.DWT&&(a.DWT=!1);"undefined"===typeof a.blur&&(a.blur=!1);"undefined"===typeof a.siftOutWidth&&(a.siftOutWidth=!1);"undefined"===typeof a.filterBank&&(a.filterBank=!1);"undefined"===typeof a.poolType&&(a.poolType="max");"undefined"===typeof a.postpreprocessing&&(a.postpreprocessing="copy");"undefined"===typeof a.density&&(a.density=1);a.filterBank&&(FilterBank.Wd(a.poolType,a.postpreprocessing),FilterBank.Vd(a.density));var b=!1;if(a.mask){b=!0;c&&
void 0!==c.Sb&&(a.mask=c.Sb+a.mask);var d=I.a({isFloat:!1,url:a.mask})}var e=!1,g="undefined"!==typeof a.preprocessing?a.preprocessing:!1,f=!1;a.sift?Sift.i({vc:l,ga_:!1,width:a.size,Sd:a.siftOutWidth}):a.DWT&&DWT.i({vc:l,ga_:!1,width:a.size});var k=!1;a.customInputShader&&(k="s41",p.Va({name:"_",id:k,c:a.customInputShader,f:["uSource"],precision:"lowp"}),p.G(k,[{type:"1i",name:"_",value:0}]));switch(g){case "sobel":var m="s30";f=!0;break;case "meanNormalization":m="s31";f=!0;break;case "grayScale":m=
"s29";f=!1;break;case "copy":m="s0";break;case "inputLightRegulation":m=k?k:"s29";Ja.i({width:a.size,tb:a.nBlurPass,yc:!1});e=!0;break;case "direct":case "none":m=!1;break;default:m="s3"}b&&(m+="Mask");if(a.blur)var r=I.a({isFloat:!1,isPot:!1,width:a.size});var h=I.a({isFloat:!1,isPot:!1,width:a.size}),t={s:function(){return a.sift?Sift.P():a.filterBank?FilterBank.P():a.size},P:function(){return t.s()},rc:function(){return a.sift?Sift.Z():a.DWT?DWT.Z():a.filterBank?FilterBank.Z():e?Ja.Z():h},w:function(){w.H();
a.blur&&(r.u(),p.set("s42"),p.I("u7",1/a.size,1/a.size),z.g(!1,!0),r.b(0));m&&(p.set(m),f&&p.A("u28",1/a.size),h.u(),b&&d.b(1),z.g(!1,!1),h.b(0),e?Ja.oa(h):a.sift?(p.M(),Sift.oa()):a.DWT?(p.M(),DWT.oa(4)):a.filterBank&&(p.M(),FilterBank.oa(h)))}};return t}},Ha={a:function(a){"undefined"===typeof a.disableNormalize&&(a.disableNormalize=!1);var b=[],d=[],e,g,f=!1,k,m=!0,r,h,t=a.isReorganize?a.isReorganize:!1,q=a.kernelsNumber?!0:!1,n=a.dynPelu?Fa.a(a.dynPelu):!1,u=n?!0:!1,A={isEnabled:!1},B;if("softmax"===
a.type){a.activation="softmax";a.size=Math.pow(2,Math.ceil(Math.log(Math.sqrt(a.num_classes))/Math.log(2)));a.sparsity="undefined"!==typeof a.sparsity?a.sparsity:a.K.P();a.gain="undefined"!==typeof a.gain?a.gain:1;p.G("s20",[{type:"1f",name:"u10",value:a.gain}]);var F=I.a({isFloat:!0,isPot:!1,width:a.size}),C=I.a({isFloat:!0,isPot:!1,width:a.size,isMipmap:!0});m=!1;var G=new Uint8Array(Math.pow(4*a.size,2)),X;for(X=0;X<a.size*a.size;++X){var da=X<a.num_classes?255:0;G[4*X]=da;G[4*X+1]=da;G[4*X+2]=
da;G[4*X+3]=da}var ha=I.a({isFloat:!1,isPot:!1,width:a.size,array:G})}else a.cost?(a.sparsity="undefined"!==typeof a.sparsity?a.sparsity:a.K.P(),m=!1):"full"===a.connectivityUp&&(a.sparsity=a.K.P());var M={elu:"s15",elu01:"s16",relu:"s14",arctan:"s18",sigmoid:"s13",copy:"s0",softplus:"s19",softmax:"s20",dynPelu:"s17"}[a.activation],Z=a.sparsity*a.sparsity,Q=!1,K=a.size;if(a.maxPooling){switch(a.maxPooling.size){case 2:var E="s32";break;case 4:E="s33"}Q=!0;K/=a.maxPooling.size;var aa=I.a({isFloat:!0,
isPot:!1,width:K})}var J=void 0!==a.Mc&&a.Mc?!0:!1,fa=null,ba=null,S=null;J&&(fa="s43"+a.index.toString(),p.lb("s43",fa,[((a.normalization.n-1)/2).toFixed(1)]),p.G(fa,[{type:"1i",name:"u1",value:0},{type:"2f",name:"u7",value:[1/a.size,1/a.size]},{type:"1f",name:"u6",value:a.normalization.alpha},{type:"1f",name:"u9",value:a.normalization.beta},{type:"1f",name:"u32",value:a.normalization.k}]),ba=I.a({isFloat:!0,isPot:!0,width:a.size}),S=I.a({isFloat:!0,isPot:!0,width:a.size}));var T,la,O,N;m&&(N=I.a({isFloat:!0,
isPot:!1,width:a.size}));var ca=I.a(a.bias),L,y={s:function(){return a.size},P:function(){return K},ib:function(){return a.num_classes},Vb:function(a){B.b(a)},Pc:function(){a.remap&&a.remap.isEnabled&&(A={isEnabled:!0,Bc:I.a({isFloat:!1,isFlipY:!1,array:new Uint8Array(a.remap.maskTexture.data),width:a.remap.maskTexture.width,isPot:!1}),layers:a.remap.layers.map(function(b){return a.parent.pc(b)}),depth:a.remap.depth})},Xc:function(){switch(a.connectivityUp){case "gaussian":L=Ka.a(a.connectivity);
break;case "direct":L=La.a(a.connectivity);break;case "square":L=Ma.a(a.connectivity);break;case "squareFast":L=Na.a(a.connectivity,a.activation);break;case "full":L=Oa.a(a.connectivity);break;case "conv":h=a.kernelsNumber,L=Pa.a(a.connectivity),t&&(r=I.a({width:K,isFloat:!0,isFlipY:!1,isPot:!1}))}if(L.L){var b=a.size*a.sparsity;la=Math.log(b/a.size)/Math.log(2);T=I.a({isMipmap:!0,isFloat:!0,isPot:!0,width:b,rb:la});O=I.a({isFloat:!0,isPot:!0,width:a.size})}},w:function(b,d){B=b;L.L?(T.u(),q&&ca.b(2),
L.w(A),T.b(0),T.gb(la),O.u(),q?p.set("s0"):(p.set("s28"),p.A("u27",Z),ca.b(1)),T.ab(la,0),z.g(!1,!1),p.set(M),J?ba.j():N.j(),O.b(0),u&&n.gc(),z.g(!1,!1)):(N.u(),ca.b(1),L.w());J&&(p.set(fa),S.j(),ba.b(0),z.g(!1,!1),p.set("s44"),p.A("u6",1),N.j(),S.b(1),z.g(!1,!1));if(m)return Q?(aa.u(),N.b(0),p.set(E),p.I("u7",1/a.size,1/a.size),z.g(!1,!1),d=aa):d=N,d.b(0),t&&(r.j(),p.set("s22"),p.I("u14",h,K/h),z.g(!1,!1),d=r,r.b(0)),d;if("softmax"===a.type){p.set("s20");N.b(0);F.j();z.g(!1,!1);a.disableNormalize?
b=F:(p.set("s2"),F.b(0),ha.b(1),C.j(),z.g(!1,!1),p.set("s0"),g.u(),C.b(0),C.gb(!1),z.g(!1,!1),p.set("s21"),e.u(),C.ab(!1,0),p.A("u12",N.tc()),g.b(1),z.g(!1,!1),b=e);if(d){switch(f){case "cpuRGBAAvg":break;default:var v=y.yb(b)}return v}return!1}if(a.cost){p.set("gpuRawAvg"===f?"s8":"s7");d=N;a.disableNormalize||(p.A("u4",1/a.size),e.u(),N.b(0),z.g(!1,!1),d=e);switch(f){case "cpuRGBA2Float":d.Aa();v=y.yb(d);k(v);break;case "gpuRawAvg":case "gpuRaw":d.b(0),k(d)}return!1}},bc:function(h){h&&"undefined"!==
typeof h.xb&&(f=h.xb,k=h.Oc);N=I.a({isFloat:!0,isPot:!0,isMipmap:"softmax"===a.type,width:a.size});"softmax"===a.type&&(g=I.a({isFloat:!0,isPot:!0,width:1}));var m=0,r=0,q="undefined"!==typeof a.num_classes&&a.num_classes?a.num_classes:a.size*a.size;for(h=0;h<q;++h)b.push(m+(a.size-1-r)*a.size),d.push([-1,-1,-1,-1]),++m,m===a.size&&(m=0,++r);a.disableNormalize||(e=I.a({isFloat:!0,isPot:!0,width:a.size}))},yb:function(a){a.Aa();var e=a.Na();b.forEach(function(a,b){d[b][0]=e[0][a];d[b][1]=e[1][a];d[b][2]=
e[2][a];d[b][3]=e[3][a]});return d}};a.K&&y.Xc(a.K);return y}};function Qa(){var a={Kd:!1},b,d;a||(a={});this.pc=function(a){return b[a]};this.Uc=function(a){var e=!1;b=a.map(function(a,b){return e=a=Ia.a({index:b,parent:this,bd:a,K:e})});d=b[b.length-1];b.forEach(function(a,b){0!==b&&a.Pc()})};this.w=function(a,d){var e=d;b.forEach(function(b){e=b.w(e,a)});return e};this.sc=function(){return d.s()};this.Z=function(){return d.rc()};this.Wc=function(a){d.bc(a)};this.ib=function(){return d.ib()}}
var La={a:function(a){var b=I.a(a.weights);delete a.weights.data;return{L:!0,Y:function(){return 1},uc:function(){return b},w:function(){p.set("s27");b.b(1);z.g(!1,!1)}}}},Oa={a:function(a){var b=a.fromLayerSize,d=I.a(a.weights);return{L:!0,Y:function(){return b},w:function(b){if(b.isEnabled){p.set("s25");b.Bc.b(3);var e,f=Math.min(b.layers.length,b.depth);for(e=0;e<f;++e)b.layers[e].Vb(4+e)}else p.set("s24");p.A("u18",a.toLayerSize);d.b(1);z.g(!1,!1)}}}},Ka={a:function(a){var b=a.toSparsity*a.toLayerSize,
d=b/a.fromLayerSize,e=I.a(a.weights);I.a({width:b,isFloat:!0,array:new Float32Array(a.fromBindings),isPot:!0});var g=I.a({width:b,isFloat:!0,array:new Float32Array(a.toBindings),isPot:!0});return{L:!0,Y:function(){return d},w:function(){p.set("s23");e.b(1);g.b(2);z.g(!1,!0)}}}},Ma={a:function(a){var b=a.fromLayerSize,d=a.toLayerSize,e=a.toSparsity,g=e*d,f=g/b,k=b/d,m,r,h,t,q=0,n=0,u=0,A=Array(e*d*e*d*4),B=Array(e*d*e*d*4),F=Array(b*b);for(m=0;m<F.length;++m)F[m]=0;var C=Math.floor(e/2),G=.5/d,X=.5/
b,da=.5/g;for(m=0;m<d;++m)for(r=0;r<d;++r){var ha=Math.round(m*k);var M=Math.round(r*k);var Z=m/d;var Q=r/d;Z+=G;Q+=G;for(h=0;h<e;++h)for(t=0;t<e;++t){var K=q/g;var E=n/g;var aa=ha+h-C;var J=M+t-C;0>aa&&(aa+=b);0>J&&(J+=b);aa>=b&&(aa-=b);J>=b&&(J-=b);var fa=aa/b;var ba=J/b;E=1-E-1/g;fa+=X;ba+=X;K+=da;E+=da;var S=m*e+h,T=r*e+t;T=d*e-T-1;S=T*d*e+S;A[4*S]=K;A[4*S+1]=E;A[4*S+2]=fa;A[4*S+3]=ba;fa=F[J*b+aa]++;ba=fa%f;aa=aa*f+ba;J=J*f+(fa-ba)/f;J=b*f-1-J;J=J*b*f+aa;B[4*J]=K;B[4*J+1]=E;B[4*J+2]=Z;B[4*J+3]=
Q;++q>=g&&(q=0,++n);++u}}var la=I.a(a.weights);I.a({width:g,isFloat:!0,array:new Float32Array(B),isPot:!0});B=null;var O=I.a({width:g,isFloat:!0,array:new Float32Array(A),isPot:!0});A=null;return{L:!0,Y:function(){return f},w:function(){p.set("s23");la.b(1);O.b(2);z.g(!1,!1)}}}},Pa={a:function(a){var b=a.kernelsNumber,d=a.toSparsity,e=d*a.toLayerSize/a.fromLayerSize,g=I.a(a.weights);return{L:!0,Y:function(){return e},Fd:function(){return d},uc:function(){return g},w:function(){p.set("s26");p.A("u24",
b);p.A("u25",d);p.A("u18",a.toLayerSize);p.A("u26",a.fromLayerSize);g.b(1);z.g(!1,!1)}}}},Na={a:function(a,b){var d=a.fromLayerSize,e=a.toLayerSize,g=a.toSparsity,f=a.stride?a.stride:1,k=g*e/d,m=e<d,r=d/e,h=I.a(a.weights),t="s45"+[d.toString(),e.toString(),g.toString(),f.toString(),b].join("_");p.jc(t)||(a=sa(b),e=[{type:"1f",name:"u18",value:e},{type:"1f",name:"u31",value:f}],m&&e.push({type:"1f",name:"u26",value:d}),d=[(m?k:g).toFixed(1),a],m&&d.push(r.toFixed(1)),p.lb(m?"s38":"s37",t,d),p.G(t,
e.concat([{type:"1i",name:"u16",value:0},{type:"1i",name:"u23",value:1},{type:"1i",name:"u15",value:3}])));return{L:!1,Y:function(){return k},w:function(){p.set(t);h.b(3);z.g(!1,!1)}}}},Ja=function(){var a,b,d,e,g,f,k,m,r;return{i:function(h){a=h.tb?h.tb:3;b=h.width?h.width:64;e=h.yc?!0:!1;h={isFloat:!1,width:b,isPot:!1,isFlipY:!1};g=I.a(h);f=I.a(h);k=I.a(h);m=I.a(h);r=I.a({isFloat:!0,width:b,isPot:!1,isFlipY:!1});d=1/b},oa:function(b){p.set("s35");for(var h=0;h<a;++h)g.j(),p.I("u7",d,0),z.g(e,!1),
f.j(),g.b(0),p.I("u7",0,d),z.g(e,!1),f.b(0);p.set("s34");m.j();b.b(0);z.g(e);p.set("s35");for(h=0;h<a;++h)k.j(),m.b(0),p.I("u7",d,0),z.g(e,!1),m.j(),k.b(0),p.I("u7",0,d),z.g(e,!1);p.set("s36");r.j();b.b(0);f.b(1);m.b(2);z.g(e,!1);r.b(0)},Z:function(){return r}}}();function Ra(a,b){a[b]=!0;a.setAttribute(b,"true")}function Sa(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}
function Ta(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("safari")&&-1===a.indexOf("chrome")?!0:!1}function Ua(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?!0:!1}
function Va(a){if(!a)return a;var b=!1;if(a.video){var d=function(a){var b={};"undefined"!==typeof a.min&&(b.min=a.min);"undefined"!==typeof a.max&&(b.max=a.max);"undefined"!==typeof a.ideal&&(b.ideal=a.ideal);return b};b={};"undefined"!==typeof a.video.width&&(b.width=d(a.video.width));"undefined"!==typeof a.video.height&&(b.height=d(a.video.height));"undefined"!==typeof a.video.facingMode&&(b.facingMode=a.video.facingMode)}b={audio:a.audio,video:b};"undefined"!==typeof a.deviceId&&(b.deviceId=a.deviceId);
return b}function Wa(a){var b=a.video.width;a.video.width=a.video.height;a.video.height=b;return a}
function Xa(a){function b(a){return[480,576,640,648,720,768,800,960,1080,1152,1280,1366,1920].sort(function(b,d){return Math.abs(b-a)-Math.abs(d-a)})}function d(b){e.push(b(Va(a)))}var e=[];if(!a||!a.video)return e;if(a.video.width&&a.video.height){if(a.video.width.ideal&&a.video.height.ideal)for(var g=b(a.video.width.ideal).slice(0,3),f=b(a.video.height.ideal).slice(0,3),k=0,m;k<g.length;++k){m=g[k];for(var r=0,h;r<f.length;++r)if(h=f[r],m!==a.video.width.ideal||h!==a.video.height.ideal){var t=Math.max(m,
h)/Math.min(m,h);t<4/3-.1||t>16/9+.1||d(function(a){a.video.width.ideal=m;a.video.height.ideal=h;return a})}}d(function(a){return Wa(a)})}a.video.width&&a.video.height&&(a.video.width.ideal&&a.video.height.ideal&&d(function(a){delete a.video.width.ideal;delete a.video.height.ideal;return a}),d(function(a){delete a.video.width;delete a.video.height;return a}));a.video.facingMode&&(d(function(a){delete a.video.facingMode;return a}),a.video.width&&a.video.height&&d(function(a){Wa(a);delete a.video.facingMode;
return a}));e.push({audio:a.audio,video:!0});return e}function Ya(a){try{var b=window.matchMedia("(orientation: portrait)").matches?!0:!1}catch(e){b=window.innerHeight>window.innerWidth}if(b&&a&&a.video){b=a.video.width;var d=a.video.height;b&&d&&b.ideal&&d.ideal&&b.ideal>d.ideal&&(a.video.height=b,a.video.width=d)}}
function Za(a){a.volume=0;Ra(a,"muted");if(Ta()){if(1===a.volume){var b=function(){a.volume=0;window.removeEventListener("mousemove",b,!1);window.removeEventListener("touchstart",b,!1)};window.addEventListener("mousemove",b,!1);window.addEventListener("touchstart",b,!1)}setTimeout(function(){a.volume=0;Ra(a,"muted")},5)}}
function $a(a,b,d,e){function g(a){f||(f=!0,d(a))}var f=!1;navigator.mediaDevices.getUserMedia(e).then(function(d){function e(){setTimeout(function(){if(a.currentTime){var e=a.videoWidth,h=a.videoHeight;if(0===e||0===h)g("VIDEO_NULLSIZE");else{e&&(a.style.width=e.toString()+"px");h&&(a.style.height=h.toString()+"px");e={$b:null,ad:null,Ec:null};try{var k=d.getVideoTracks()[0];k&&(e.Ec=k,e.$b=k.getCapabilities(),e.ad=k.getSettings())}catch(q){}Ta()||Sa()?a.parentNode&&null!==a.parentNode?(f||b(a,d,
e),setTimeout(function(){a.play()},100)):(document.body.appendChild(a),Za(a),f||b(a,d,e),setTimeout(function(){a.style.transform="scale(0.0001,0.0001)";a.style.position="fixed";a.style.bottom="0px";a.style.right="0px";Za(a);setTimeout(function(){a.play()},100)},80)):f||b(a,d,e)}}else g("VIDEO_NOTSTARTED")},700)}"undefined"!==typeof a.srcObject?a.srcObject=d:(a.src=window.URL.createObjectURL(d),a.videoStream=d);Za(a);a.addEventListener("loadeddata",function(){var b=a.play();Za(a);"undefined"===typeof b?
e():b.then(function(){e()}).catch(function(){g("VIDEO_PLAYPROMISEREJECTED")})},!1)}).catch(function(a){g(a)})}
function ab(a,b,d){var e=Ua()?document.createElement("video"):!1;e?Ua()?(d&&d.video&&(Sa()&&Ya(d),d.video.width&&d.video.width.ideal&&(e.style.width=d.video.width.ideal+"px"),d.video.height&&d.video.height.ideal&&(e.style.height=d.video.height.ideal+"px")),Ra(e,"autoplay"),Ra(e,"playsinline"),d&&d.audio?e.volume=0:Ra(e,"muted"),$a(e,a,function(){function g(d){if(0===d.length)b("INVALID_FALLBACKCONSTRAINS");else{var f=d.shift();$a(e,a,function(){g(d)},f)}}var f=Xa(d);g(f)},d)):b&&b("MEDIASTREAMAPI_NOTFOUND"):
b&&b("VIDEO_NOTPROVIDED")}
var bb=function(){var a=0,b,d,e,g;return{i:function(f,k){a=f.length;b=k;d=f;e=new Float32Array(a);g=new Float32Array(a)},qc:function(){return g},cd:function(a,k,m){a.forEach(function(a,f){var h=Math.min(1,d[f]*m*(k+.33*(1-k)));a=h*a+(1-h)*e[f];e[f]=a;g[f]=b[f](a)})}}}(),V={U:[],va:!1,wa:!1,ua:!1,Ua:!1,ca:!0,ba:!1,ready:!1,initialized:!1},cb={facingMode:"user",idealWidth:320,idealHeight:240,minWidth:240,maxWidth:1280,minHeight:240,maxHeight:1280},c={save:"jeelizFaceTransferNNC.json",Sa:"../../",
Rb:0,ka:64,width:512,height:512,Fc:.25,Cc:.7,Jc:3,borderWidth:.4,X:.35,Kc:5,Lc:3,Qa:[.06,.08,.15],ed:55,Gc:.6,Dc:5.8,Nb:.75,Mb:1,Wa:[.03,1],hd:20,ea:.2,N:[30,55],Ta:3,Tb:1/3.5,wb:11,sb:1,Hc:1,Xa:[.1,.01],Rc:[.4,-.7,-.4],Sc:[.3,0,0],Db:[5,7],fc:!1,T:[0,7],Za:.001,Ya:[Math.PI/10,Math.PI/6],zb:[0,6],Ab:[.1,.4],Bb:[.009,.02],Cb:[.02,.04],La:8,kb:[3,7],jb:.05,Qb:[.2,.2,.15,.15,.15,.15,.2,.2,.15,.15,.2],Ic:[oa.bind(null,.05,.7),oa.bind(null,.05,.7),oa.bind(null,0,.4),oa.bind(null,0,.4),oa.bind(null,0,.6),
oa.bind(null,0,.6),qa.bind(null,.1,.6),oa.bind(null,.1,.4),ra.bind(null,.68,.77,2),ra.bind(null,.68,.77,2),oa.bind(null,.15,.5)]};V.get_nMorphs=function(){return c.wb};var db=!1;
function eb(){var a,b,d,e,g,f,k,m,r,h,t;function q(){++y;1===y&&(bb.i(c.Qb,c.Ic),n(),V.ready=!0,V.U.forEach(function(a){a()}),V.U.splice(0,V.U.length),u(),y=0)}function n(){ba=na();S=new Uint8Array(M*M*4);V.get_morphTargetInfluences=function(){return ba};V.get_morphTargetInfluencesStabilized=function(){return bb.qc()};V.set_morphUpdateCallback=function(a){ca=a};V.get_rotation=function(){return la};V.get_positionScale=function(){var a=J.Ib.oc();a.Aa();a=a.Na();L[0]=1-a[1][0];L[1]=a[2][0];L[2]=a[3][0]*
Z[0];return L};V.get_rotationStabilized=function(){return N};V.switch_sleep=function(a){ia!==v.ra||a?ia=a?v.ra:v.ha:u()};V.on_detect=function(a){a(R.F);R.Ma.push(a)};V.is_detected=function(){return R.F};V.set_animateDelay=function(a){G=a}}function u(){ia!==v.ha&&(ia=v.ha,H.timestamp=Date.now(),X&&window.clearTimeout(X),da&&window.cancelAnimationFrame(da),B())}function A(){ia!==v.ra&&(X=setTimeout(B,G))}function B(){var a=E.currentTime-ka;0>a&&(ka=E.currentTime);1E3*a<c.hd||(aa.refresh(),ka+=a,p.set("s47"),
w.H(),J.Ga.u(),aa.b(0),z.g(!1,!0));a=ia===v.ha?H.na:1;for(var b=0;b<a;++b){var d=J,e=ha;p.set("s48");w.H();d.Ha.u();d.Ga.b(0);d.sa.b(1);z.g(!1,!1);d.Ha.b(0);e.w(!1,d.Ha)}V.ca&&(w.fd(),p.set("s5"),J.Ga.b(0),z.g(!1,!1),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE),fa.b(0),z.g(!1,!1),l.disable(l.BLEND));l.flush();b=Date.now();d=b-H.timestamp;H.timestamp=b;H.ub=a/d;H.Ka=H.ub*c.ea+H.Ka*(1-c.ea);H.vb=1E3/d;H.S=H.vb*c.ea+H.S*(1-c.ea);H.S>c.N[1]?(++H.na,H.S=(c.N[0]+c.N[1])/2):H.S<c.N[0]&&(H.na=Math.max(H.na-
1,c.Ta),H.S=(c.N[0]+c.N[1])/2);H.fa=c.Tb/Math.max(H.Ka,.001);ia!==v.ra&&(da=window.requestAnimationFrame(A))}var F,C,G=c.Rb,X=!1,da=!1,ha,M,Z,Q,K,E,aa,J={},fa,ba=!1,S,T=[0,0,0],la=[0,0,0],O=[0,0,0],N=[0,0,0],ca=!1,L=[0,0,0],y=0,v={Ac:-2,ra:-1,ha:0},ia=v.Ac,R={ma:0,F:!1,Ma:[]},H={timestamp:0,ub:0,Ka:0,na:c.Ta,vb:0,S:0,fa:1},U=1,Ca=1,Da=1,pa=1,P=[0,0,0],W=Date.now(),Y=new Float32Array(c.La),ea=0,ka=0,ma={xc:function(){F=c.width;C=c.height;Q=c.Fc;K=c.Cc;var n=F/c.ka;Q*=n;K*=n;g=(1-2*c.borderWidth)/c.Kc;
f=(1-2*c.X)/c.Lc;k=(K-Q)/c.Jc;m=c.borderWidth;r=c.X;h=1-c.borderWidth;t=1-c.X;a=0;b=c.borderWidth;d=c.X;e=Q;Z=[c.ka/F,c.ka/C]},i:function(n){function v(){R.ma=c.jb*D(c.kb[0],c.kb[1])+(1-c.jb)*R.ma;.6<R.ma&&!R.F?(R.Ma.forEach(function(a){a(!0)}),R.F=!0):.4>R.ma&&R.F&&(R.Ma.forEach(function(a){a(!1)}),R.F=!1)}function D(a,b){a+=M*b;return(S[4*a]+S[4*a+1]+S[4*a+2]+S[4*a+3])/1020}function y(){ba.forEach(function(a,b){if(R.F){a=(c.sb+b)%M;var d=c.Hc+Math.floor((c.sb+b)/M);d=M-1-d;ba[b]=D(a,d)}else ba[b]=
0})}E=n;aa=I.a({v:E,isPot:!1,isFloat:!1,isFlipY:!0});p.Pb([{id:"s47",name:"_",aa:"attribute vec2 a0;uniform vec2 u33,u34;varying vec2 vv0;void main(){gl_Position=vec4(a0,0.,1.),vv0=u34+u33*a0;}",da:["a0"],V:[2],c:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",f:["u1","u33","u34"],precision:"lowp"},{id:"s48",name:"_",c:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",aa:"attribute vec2 a0;uniform sampler2D u35;uniform vec2 u36;const vec2 f=vec2(.25,.5),h=vec2(.75,.5),e=vec2(.5,.5);varying vec2 vv0;void main(){vec4 a=texture2D(u35,f);vec2 b=a.gb,c=a.a*u36,d=a0*.5+e;vv0=b+(d-e)*c,gl_Position=vec4(a0,0.,1.);}",
da:["a0"],V:[2],f:["u1","u35","u36"],precision:"lowp"},{id:"s49",name:"_",aa:"attribute vec2 a0;void main(){gl_Position=vec4(a0,0.,1.);}",c:"uniform sampler2D u37,u35;uniform vec3 u38,u39;uniform float u40,u41,u42,u43,u44,u45,u46;varying vec2 vv0;const vec4 e=vec4(.25,.25,.25,.25);void main(){vec4 g=texture2D(u37,vec2(.4375,.9375)),h=texture2D(u37,vec2(.5625,.9375)),a=texture2D(u35,vec2(.5,.5));float c=dot(g,e),i=dot(h,e);bool d=c>u43&&c>i+u44;d?a.r=2.:a.r>u42?a.r=0.:a.r>1.9&&(a.a>u41||a.a<u40)?a.r=0.:a.r>1.9?a.r+=1.:0.;if(a.r<.9)a.gba=u38,a.r=1.;else{float j=dot(e,texture2D(u37,vec2(.0625,.9375))),k=dot(e,texture2D(u37,vec2(.1875,.9375))),l=dot(e,texture2D(u37,vec2(.3125,.9375))),b;if(a.r>1.9)b=1.-u46;else b=1.,a.r=0.;float f=a.a*u45;a.gba+=vec3(j,k,l)*u39*b*f;}gl_FragColor=a;}",
f:"u37 u35 u38 u40 u41 u42 u43 u44 u39 u45 u46".split(" ")},{id:"s50",name:"_",c:"uniform sampler2D u35;uniform vec2 u36;varying vec2 vv0;const vec2 j=vec2(1.,1.);const vec4 i=vec4(0.,.5,1.,1.);void main(){vec4 g=texture2D(u35,vec2(.25,.5));vec2 h=g.gb;float k=g.a;vec2 a=k*u36,c=h+a,d=h;d-=a/2.,c-=a/2.;vec2 l=.5*(d+c),f=step(d,vv0)*step(vv0,c);float m=f.x*f.y;vec2 b=2.*abs(l-vv0)/a;b=pow(b,3.*j),gl_FragColor=m*i*max(b.x,b.y);}",f:["u35","u36"],precision:"lowp"},{id:"s51",name:"_",c:"uniform sampler2D u1,u5;uniform float u50,u51,u46;const vec4 f=vec4(1.,1.,1.,1.);varying vec2 vv0;void main(){vec4 a=texture2D(u1,vv0),b=texture2D(u5,vv0);float c=(1.-u46)*(u51-u50)+u50;gl_FragColor=mix(b,a,c*f);}",
f:["u1","u5","u50","u51","u46"],precision:"highp"}]);p.G("s48",[{type:"1i",name:"u1",value:0},{type:"1i",name:"u35",value:1},{type:"2f",name:"u36",value:Z}]);p.G("s50",[{type:"1i",name:"u35",value:0},{type:"2f",name:"u36",value:Z}]);p.G("s49",[{type:"1i",name:"u37",value:0},{type:"1i",name:"u35",value:1},{type:"1f",name:"u40",value:c.Gc},{type:"1f",name:"u41",value:c.Dc},{type:"1f",name:"u42",value:c.ed},{type:"1f",name:"u43",value:c.Nb},{type:"1f",name:"u44",value:c.Mb},{type:"1f",name:"u45",value:Z[0]}]);
p.G("s51",[{type:"1i",name:"u1",value:0},{type:"1i",name:"u5",value:1},{type:"1f",name:"u50",value:c.Wa[0]},{type:"1f",name:"u51",value:c.Wa[1]}]);fa=I.a({isPot:!1,isFloat:!1,width:F,height:C});var u=new Float32Array([0,c.borderWidth,c.X,0]);(function(a){a.Ga=I.a({isPot:!1,Rd:!0,isFloat:!1,width:F,height:C});a.Ha=I.a({isPot:!0,isFloat:!1,width:c.ka});var b={width:1,height:1,isFloat:!0,isPot:!1,array:u};a.sa=Ba.a(b);a.Ib=Ba.a(b)})(J);ja(function(n){n=JSON.parse(n);ha=new Qa;ha.Uc(n.layers);ha.Wc({xb:"gpuRaw",
Oc:function(n){var q=J;q.sa.Fb(1);l.viewport(0,0,1,1);p.set("s49");p.A("u46",U);p.Gb("u38",b,d,e);p.Gb("u39",1*c.Qa[0],1*c.Qa[1],1*c.Qa[2]);z.g(!1,!1);1!==++a%2&&(e+=k,e>K&&(b+=g,e=Q,b>h&&(b=m,d+=f,d>t&&(d=r))));q.Ib.Fb(1);p.set("s51");p.A("u46",U);q.sa.b(0);z.g(!1,!1);I.Qc(n,S);y();if(!c.fc&&R.F)for(q=0;3>q;++q)n=D(q+c.Db[0],c.Db[1]),n=(2*n-1)*c.Rc[q],n+=c.Sc[q],T[q]=n;v();n=Date.now();q=n-W;Da=qa(c.Ab[0],c.Ab[1],D(c.zb[0],c.zb[1]));var u=D(c.T[0],c.T[1]),A=D(c.T[0]+1,c.T[1]),B=D(c.T[0]+2,c.T[1]);
Ca=1-qa(c.Cb[0],c.Cb[1],Math.sqrt(u*u+A*A+B*B)/q);u=P[0]-T[0];A=P[1]-T[1];B=P[2]-T[2];q=Math.sqrt(u*u+A*A+B*B)/q;P[0]=T[0];P[1]=T[1];P[2]=T[2];pa=1-qa(c.Bb[0],c.Bb[1],q);U=Da*Ca*pa;W=n;Y[ea]=U;ea=(ea+1)%c.La;for(n=0;n<c.La;++n)U=Math.min(Y[n],U);bb.cd(ba,U,H.fa);ca&&ca(U,H.fa);if(R.F)for(n=c.Xa[1]*U+c.Xa[0]*(1-U),n*=H.fa,q=0;3>q;++q)la[q]=n*T[q]+(1-n)*la[q],N[q]=la[q];else n=Date.now(),O[0]=c.Ya[0]*Math.sin(n*c.Za),O[1]=c.Ya[1]*Math.cos(n*c.Za),N[0]=O[0],N[1]=O[1],N[2]=O[2];n=J;w.H();fa.u();p.set("s50");
n.sa.b(0);z.g(!1,!1)}});M=ha.sc();q()})},Yc:function(a,b){for(var d in a)"undefined"!==typeof b[d]&&(a[d]=b[d])},ac:function(a){V.va&&V.va();var b={video:{facingMode:{ideal:cb.facingMode},width:{min:cb.minWidth,max:cb.maxWidth,ideal:cb.idealWidth},height:{min:cb.minHeight,max:cb.maxHeight,ideal:cb.idealHeight}},audio:V.Ua};cb.deviceId&&(constraints.deviceId=cb.deviceId);ab(function(b,d){db=d;V.wa&&V.wa();a(b)},function(){window.ta&&window.ta("WEBCAM_UNAVAILABLE")},b)},qb:function(a,b){var d=a.videoWidth,
e=a.videoHeight;Aa.ia().width=d;Aa.ia().height=e;c.width=d;c.height=e;ma.xc();var f=[.5,.5];e/=d;d=Aa.D()/Aa.s();e>d?1>=e?f[0]*=e:f[1]/=e:(f[0]*=e,e=1/d,f[0]*=e,f[1]*=e);f[1]*=d;ma.i(a);p.G("s47",[{type:"1i",name:"u1",value:0},{type:"2f",name:"u33",value:f},{type:"2f",name:"u34",value:[.5,.5]}]);b&&b()}};return ma}V.onLoad=function(a){V.ready?a():V.U.push(a)};V.set_audio=function(a){V.Ua=a};V.switch_displayVideo=function(a){V.ca=a;V.ba&&(V.ba.style.display=V.ca?"block":"none")};
V.onWebcamAsk=function(a){V.va=a};V.onContextLost=function(a){V.ua=a};V.onWebcamGet=function(a){V.wa=a};V.set_size=function(a,b){c.width=a;c.height=b};V.get_size=function(){return{width:c.width,height:c.height}};V.get_videoStream=function(){return db};V.get_cv=function(){return Aa.ia()};
V.init=function(a){var b=eb(),d=a.callbackReady?a.callbackReady:function(a){console.log("ERR:",a)},e=a.callbackReady?a.callbackReady.bind(!1):!1;if("undefined"===typeof a.canvasId)d("NO_CANVASID");else if(document.getElementById(a.canvasId))if(V.initialized)d("ALREADY_INITIALIZED");else{V.initialized=!0;window.ta=d?function(a){d(a);window.ta=!1}:!1;a.NNCpath&&(c.Sa=a.NNCpath);V.U.push(e);if(!Aa.i({eb:a.canvasId,width:c.width,height:c.height,debug:!1,Ia:!1,Nc:function(){V.ua&&V.ua()},premultipliedAlpha:!1}))return d("GL_INCOMPATIBLE"),
!1;V.ba=Aa.ia();V.ca||(V.ba.style.display="none");z.i();w.i();p.i();I.i();l.depthFunc(l.LEQUAL);l.clearDepth(1);a.videoSettings&&a.videoSettings.videoElement?b.qb(a.videoSettings.videoElement,!1):(a.videoSettings&&b.Yc(cb,a.videoSettings),b.ac(function(a){b.qb(a,!1)}));return!0}else d("INVALID_CANVASID")};window.JEEFACETRANSFERAPI=V;
;return JEEFACETRANSFERAPI;})();

/*
This helper can help for :
* adjusting the canvas resolution to the good size -> this is crucial to
optimize the code because if the canvas is too large,
there are too much pixels to compute => it will be slow

* to mirror horizontally or not the canvas -> if the front camera is used we
need it flipped (mirror effect), while if the rear camera is used we need it not flipped

* to get the best camera resolution (either above the canvas resolution or closer)
to balance between performance and quality

@see https://appstatic.jeeliz.com/faceFilter/JeelizResizer.js
*/ 
"use strict";

window.JEELIZ_RESIZER = (function(){
    //private vars :
    var _domCanvas, _whCanvasPx, _resizeAttemptsCounter=0, _overSamplingFactor=1, _isFullScreen=false, _timerFullScreen=false, _callbackResize=false;
    var _cameraResolutions=[ //all resolutions should be in landscape mode
        [640,480],
        [768,480],
        [800,600],
        [960,640],
        [960,720],
        [1024,768],
        [1280,720]
    ];
    var _isInvFullscreenWH=false;

    //private functions
    function add_CSStransform(domElement, CSS){
        var CSStransform=domElement.style.transform;
        if (CSStransform.indexOf(CSS)!==-1) return;
        domElement.style.transform=CSS+' '+CSStransform;
    }

    //compute overlap between 2 rectangles A and B
    //characterized by their width and their height in pixels
    //the rectangles are centered
    //return the ratio (pixels overlaped)/(total pixels)
    function compute_overlap(whA, whB){ 
        var aspectRatioA=whA[0]/whA[1], aspectRatioB=whB[0]/whB[1]; //higher aspectRatio -> more landscape
        var whLandscape, whPortrait;
        if (aspectRatioA>aspectRatioB){ 
            whLandscape=whA, whPortrait=whB;
        } else {
            whLandscape=whB, whPortrait=whA;
        }

        //the overlapped area will be always a rectangle
        var areaOverlap=Math.min(whLandscape[0], whPortrait[0])*Math.min(whLandscape[1], whPortrait[1]);
        
        var areaTotal;
        if (whLandscape[0]>=whPortrait[0] && whLandscape[1]>=whPortrait[1]){ //union is a rectangle
            areaTotal=whLandscape[0]*whLandscape[1];
        } else if (whPortrait[0]>whLandscape[0] && whPortrait[1]>whLandscape[1]){ //union is a rectangle
            areaTotal=whPortrait[0]*whPortrait[1];
        } else { //union is a cross
            areaTotal=whLandscape[0]*whLandscape[1];
            areaTotal+=(whPortrait[1]-whLandscape[1])*whPortrait[0];
        }

        return areaOverlap/areaTotal;
    } //end compute_overlap()

    function update_sizeCanvas(){
        var domRect = _domCanvas.getBoundingClientRect();
        _whCanvasPx=[
            Math.round(_overSamplingFactor*domRect.width),
            Math.round(_overSamplingFactor*domRect.height)
        ];
        _domCanvas.setAttribute('width',  _whCanvasPx[0]);
        _domCanvas.setAttribute('height', _whCanvasPx[1]);
    }

    function on_windowResize(){
        if (_timerFullScreen){
            clearTimeout(_timerFullScreen);
        }
        _timerFullScreen=setTimeout(resize_fullScreen, 50);
    }

    function resize_canvasToFullScreen(){
        _whCanvasPx=[window['innerWidth'], window['innerHeight']];
        if (_isInvFullscreenWH){
            _whCanvasPx.reverse();
        }
        _domCanvas.setAttribute('width',  _whCanvasPx[0]);
        _domCanvas.setAttribute('height', _whCanvasPx[1]);
    }

    function resize_fullScreen(){
        resize_canvasToFullScreen();
        JEEFACEFILTERAPI.resize();
        _timerFullScreen=false;
        if (_callbackResize) {
            _callbackResize();
        }
    }

    //public methods :
    var that={ //return true or false if the device is in portrait or landscape mode
        is_portrait: function(){ //https://stackoverflow.com/questions/4917664/detect-viewport-orientation-if-orientation-is-portrait-display-alert-message-ad
            try{
                if (window['matchMedia']("(orientation: portrait)")['matches']){
                    return true;
                } else {
                    return false;
                }
            } catch(e){
                return (window['innerHeight'] > window['innerWidth']);
            }
        },

        //size canvas to the right resolution
        //should be called after the page loading
        //when the canvas has already the right size
        //options:
        // - <string> canvasId: id of the canvas
        // - <function> callback: function to launch if there was an error or not
        // - <float> overSamplingFactor: facultative. If 1, same resolution than displayed size (default). 
        //   If 2, resolution twice higher than real size
        // - <boolean> isFlipY: if we should flip the canvas or not. Default: false
        // - <boolean> isFullScreen: if we should set the canvas fullscreen. Default : false
        // - <function> onResize: function called when the window is resized. Only enabled if isFullScreen=true
        // - <boolean> isInvWH: if we should invert width and height for fullscreen mode only. default=false
        size_canvas: function(options){
            _domCanvas=document.getElementById(options.canvasId);
            _isFullScreen=(typeof(options.isFullScreen)!=='undefined' && options.isFullScreen);
            _isInvFullscreenWH=(typeof(options.isInvWH)!=='undefined' && options.isInvWH);

            if (_isFullScreen){
                //we are in fullscreen mode
                if (typeof(options.onResize)!=='undefined'){
                    _callbackResize=options.onResize;
                }
                resize_canvasToFullScreen();
                window.addEventListener('resize', on_windowResize, false);
            } else { //not fullscreen mode

                //get display size of the canvas
                var domRect = _domCanvas.getBoundingClientRect();
                if (domRect.width===0 || domRect.height===0){
                    console.log('WARNING in JeelizResize.size_canvas() : the canvas has its width or its height null, Retry a bit later...');
                    if (++_resizeAttemptsCounter>20){
                        options.callback('CANNOT_RESIZECANVAS');
                        return;
                    }
                    setTimeout(that.size_canvas.bind(null, options), 50);
                    return;
                }

                //do resize canvas :
                _resizeAttemptsCounter=0;
                _overSamplingFactor=(typeof(options.overSamplingFactor)==='undefined')?1:options.overSamplingFactor;
                update_sizeCanvas();
            }

            //flip horizontally if required :
            if (typeof(options.isFlipY)!=='undefined' && options.isFlipY){
                add_CSStransform(_domCanvas, 'rotateY(180deg)');
            }

            //compute the best camera resolutions :
            var allResolutions=_cameraResolutions.slice(0);

            //if we are in portrait mode, the camera is also in portrait mode
            //so we need to set all resolutions to portrait mode
            if (that.is_portrait()){
                allResolutions.forEach(function(wh){
                    wh.reverse();
                });
            }

            //sort camera resolutions from the best to the worst :
            allResolutions.sort(function(resA, resB){
                return compute_overlap(resB, _whCanvasPx)-compute_overlap(resA, _whCanvasPx);
            });

            //pick the best camera resolution
            var bestCameraResolution={
                'idealWidth': allResolutions[0][0],
                'idealHeight':allResolutions[0][1]
            };

            //launch the callback function after a small interval to let it
            //some time to size
            setTimeout(options.callback.bind(null, false, bestCameraResolution), 1);
        }, //end size_canvas()

        resize_canvas: function(){ //should be called if the canvas is resized to update the canvas resolution
            if (_isFullScreen){
                return;
            }
            update_sizeCanvas();
        }
    }; //end that
    return that;
})();